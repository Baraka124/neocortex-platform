<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Platform üöÄ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        :root {
            --bg: #ffffff;
            --surface: #f8fafc;
            --text: #1e293b;
            --text-light: #64748b;
            --primary: #3b82f6;
            --accent: #8b5cf6;
            --success: #10b981;
            --border: #e2e8f0;
            --radius: 8px;
        }
        
        .dark-mode {
            --bg: #0f172a;
            --surface: #1e293b;
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
        }
        
        .controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
        }
        
        /* Content */
        .content-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--text);
        }
        
        .section-date {
            color: var(--text-light);
            font-size: 0.875rem;
        }
        
        .section-content {
            color: var(--text);
            line-height: 1.8;
        }
        
        .section-content h1,
        .section-content h2,
        .section-content h3 {
            margin: 1.5rem 0 1rem;
        }
        
        .section-content p {
            margin: 1rem 0;
        }
        
        .section-content code {
            background: rgba(0,0,0,0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'SF Mono', monospace;
        }
        
        .section-tags {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .tag {
            background: rgba(59,130,246,0.1);
            color: var(--primary);
            padding: 0.25rem 0.75rem;
            border-radius: 100px;
            font-size: 0.75rem;
        }
        
        /* Editor */
        .editor {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .editor.active {
            display: block;
        }
        
        .editor-box {
            max-width: 800px;
            margin: 2rem auto;
            background: var(--surface);
            border-radius: var(--radius);
            padding: 2rem;
            border: 1px solid var(--border);
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .editor-title {
            font-size: 1.25rem;
            color: var(--text);
        }
        
        .editor-input {
            width: 100%;
            min-height: 400px;
            font-family: 'SF Mono', monospace;
            font-size: 14px;
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            resize: vertical;
            margin-bottom: 1rem;
        }
        
        .editor-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--surface);
            color: var(--text);
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateY(0);
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        @media (max-width: 640px) {
            .container {
                padding: 10px;
            }
            
            .content-section {
                padding: 1rem;
            }
            
            .editor-box {
                padding: 1rem;
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Editor -->
    <div class="editor" id="editor">
        <div class="editor-box">
            <div class="editor-header">
                <div class="editor-title">Edit Content ‚úèÔ∏è</div>
                <button class="btn" onclick="closeEditor()">Close</button>
            </div>
            <textarea class="editor-input" id="editorInput" spellcheck="false"></textarea>
            <div class="editor-actions">
                <button class="btn" onclick="closeEditor()">Cancel</button>
                <button class="btn btn-primary" onclick="saveContent()">üíæ Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Main Content -->
    <div class="container">
        <div class="header">
            <div class="logo">üöÄ My Platform</div>
            <div class="controls">
                <button class="btn" onclick="toggleTheme()" id="themeBtn">üåô</button>
                <button class="btn btn-primary" onclick="openEditor()">‚úèÔ∏è Edit Content</button>
            </div>
        </div>
        
        <div id="contentContainer">
            <!-- Content loads here -->
            <div style="text-align: center; padding: 4rem; color: var(--text-light);">
                <div style="width: 40px; height: 40px; border: 3px solid rgba(59,130,246,0.3); border-radius: 50%; border-top-color: var(--primary); animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                Loading content...
            </div>
        </div>
    </div>
    
    <script>
        // ========== CORE ==========
        class Platform {
            constructor() {
                this.content = '';
                this.sections = [];
                this.apiBase = window.location.origin;
                this.init();
            }
            
            async init() {
                this.loadTheme();
                await this.loadContent();
                this.render();
                console.log('üöÄ Platform ready!');
            }
            
            async loadContent() {
                try {
                    const response = await fetch(`${this.apiBase}/api/content`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.content = data.content;
                        this.parseContent();
                        this.showNotification('Content loaded', 'success');
                    } else {
                        throw new Error('Failed to load');
                    }
                } catch (error) {
                    console.error('Error loading:', error);
                    this.showNotification('Using offline mode', 'error');
                    this.loadDemoContent();
                }
            }
            
            parseContent() {
                const rawSections = this.content.split(/\n---\n/);
                this.sections = [];
                
                rawSections.forEach((section, index) => {
                    if (section.trim()) {
                        const parsed = this.parseSection(section, index);
                        if (parsed) {
                            this.sections.push(parsed);
                        }
                    }
                });
            }
            
            parseSection(text, id) {
                const lines = text.trim().split('\n');
                const section = {
                    id,
                    title: 'Untitled',
                    content: '',
                    date: new Date().toISOString().split('T')[0],
                    tags: [],
                    raw: text
                };
                
                let inFrontmatter = false;
                let contentLines = [];
                
                for (const line of lines) {
                    if (line.trim() === '---') {
                        inFrontmatter = !inFrontmatter;
                        continue;
                    }
                    
                    if (inFrontmatter) {
                        const match = line.match(/^([^:]+):\s*(.+)$/);
                        if (match) {
                            const [, key, value] = match;
                            const cleanKey = key.trim().toLowerCase();
                            const cleanValue = value.trim();
                            
                            if (cleanKey === 'title') section.title = cleanValue;
                            if (cleanKey === 'date') section.date = cleanValue;
                            if (cleanKey === 'tags') section.tags = cleanValue.split(',').map(t => t.trim());
                        }
                    } else {
                        contentLines.push(line);
                    }
                }
                
                section.content = contentLines.join('\n');
                return section;
            }
            
            render() {
                const container = document.getElementById('contentContainer');
                if (this.sections.length === 0) {
                    container.innerHTML = `
                        <div class="content-section">
                            <h2>Start Writing ‚úçÔ∏è</h2>
                            <p>Click the Edit button to add your first content!</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = this.sections.map(section => `
                    <article class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">${section.title}</h2>
                            <span class="section-date">${this.formatDate(section.date)}</span>
                        </div>
                        
                        <div class="section-content">
                            ${this.renderMarkdown(section.content)}
                        </div>
                        
                        ${section.tags.length > 0 ? `
                            <div class="section-tags">
                                ${section.tags.map(tag => `
                                    <span class="tag">#${tag}</span>
                                `).join('')}
                            </div>
                        ` : ''}
                    </article>
                `).join('');
            }
            
            renderMarkdown(text) {
                return text
                    .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                    .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                    .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`([^`]+)`/g, '<code>$1</code>')
                    .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img alt="$1" src="$2" style="max-width:100%; border-radius:8px; margin:1rem 0;">')
                    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color:var(--primary);">$1</a>')
                    .replace(/^\s*-\s+(.*$)/gm, '<li>$1</li>')
                    .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
                    .replace(/^\s*\d+\.\s+(.*$)/gm, '<li>$1</li>')
                    .replace(/(<li>.*<\/li>)/s, '<ol>$1</ol>')
                    .replace(/^>\s+(.*$)/gm, '<blockquote style="border-left: 3px solid var(--primary); padding-left: 1rem; margin: 1rem 0; color: var(--text-light);">$1</blockquote>')
                    .replace(/\n\n/g, '</p><p>')
                    .replace(/\n/g, '<br>');
            }
            
            async saveContent(newContent) {
                try {
                    this.showNotification('Saving...', 'success');
                    
                    const response = await fetch(`${this.apiBase}/api/content`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content: newContent })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.content = newContent;
                        this.parseContent();
                        this.render();
                        this.showNotification('Saved successfully!', 'success');
                        return true;
                    } else {
                        throw new Error(data.error || 'Save failed');
                    }
                } catch (error) {
                    console.error('Save error:', error);
                    this.showNotification('Save failed. Try again.', 'error');
                    return false;
                }
            }
            
            // ========== UTILITIES ==========
            formatDate(dateStr) {
                const date = new Date(dateStr);
                const now = new Date();
                const diff = now - date;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (days === 0) return 'Today';
                if (days === 1) return 'Yesterday';
                if (days < 7) return `${days} days ago`;
                if (days < 30) return `${Math.floor(days / 7)} weeks ago`;
                return date.toLocaleDateString();
            }
            
            loadTheme() {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('themeBtn').textContent = '‚òÄÔ∏è';
                }
            }
            
            toggleTheme() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                document.getElementById('themeBtn').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            }
            
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            loadDemoContent() {
                this.content = `---
title: Welcome Demo
date: ${new Date().toISOString().split('T')[0]}
tags: demo, welcome
---

# Offline Mode

This is demo content. The server connection failed.

## Features
- **Edit interface** still works
- **Markdown rendering**
- **Dark/light mode**
- **Responsive design**`;
                
                this.parseContent();
            }
        }
        
        // ========== GLOBAL ==========
        const platform = new Platform();
        
        function openEditor() {
            const editor = document.getElementById('editor');
            const input = document.getElementById('editorInput');
            input.value = platform.content;
            editor.classList.add('active');
            input.focus();
        }
        
        function closeEditor() {
            document.getElementById('editor').classList.remove('active');
        }
        
        async function saveContent() {
            const input = document.getElementById('editorInput');
            const success = await platform.saveContent(input.value);
            if (success) {
                closeEditor();
            }
        }
        
        function toggleTheme() {
            platform.toggleTheme();
        }
        
        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
